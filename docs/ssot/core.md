# WakuWork Circle 仕様コア

> **Version**: v0.1  
> **Updated**: 2026-02-02  
> **Authority**: このファイルが仕様の最終権威。矛盾時は本ファイルを正とする。

---

## 1. 目的

配信者が「作業セッション部屋」を立て、視聴者が入室して **同席作業 + 応援** できるWebサービス。

### 1.1 非目的（MVPでやらないこと）

- 決済実装（応援はスタブ）
- ランキング機能
- 交換性（応援で機能解放・優先権等）
- 運営による常時監視
- 通話機能
- 視聴者間DM

---

## 2. 用語定義

| 用語 | 定義 |
|------|------|
| **Room** | 配信者の「器」。配信者1人につき1つ。永続的。 |
| **Session** | 配信1回分。Room内で開始/終了される。一時的。 |
| **SessionCode** | セッション参加用の英数字コード。**自動生成**（配信者は変更不可）。 |
| **Passphrase** | セッション参加用の合言葉。**配信者が単語で手動設定・手動更新**。 |
| **JoinRequest** | ロビーでの参加承認待ち状態。 |
| **Member** | セッションに承認済みで参加中のユーザー。 |
| **Lobby** | 承認待ちの待機場所。ルーム初回参加者は必ず経由。 |

---

## 3. 認証

- **方式**: Discord OAuth のみ
- **視聴者ログイン**: **必須**（匿名参加不可）
- **配信者ログイン**: 必須

---

## 4. 可視性（誰が誰を見れるか）

### 4.1 配信者に見える情報

| 情報 | 可視性 |
|------|--------|
| OAuth実ID（Discord名） | 常に見える |
| ニックネーム | 設定時のみ |
| ルーム初回フラグ | 常に見える |
| 参加履歴（Pro） | 30日保持 |

### 4.2 視聴者同士の可視性

**デフォルト: 匿名**（視聴者同士はお互いの実IDを見えない）

配信者設定で以下の表示名モードを選択:

| Mode | 表示名 | 説明 |
|------|--------|------|
| Mode 1 | `参加者#N` | 完全匿名。入室順の番号のみ。 |
| Mode 2 | ニックネーム | ユーザー設定のニックネーム表示。 |
| Mode 3 | 動物・魚・鳥名 | 独自辞書から生成。セッション内固定、セッション跨ぎで変化。 |

### 4.3 Mode 3 生成規則

- **辞書**: 独自作成（Google等の実装を参照しない）
- **固定性**: 同一セッション内ではリロードしても同じ名前
- **可変性**: セッションが変わると名前も変わる
- **生成元**: `userId + sessionId` のハッシュから決定論的に選択

---

## 5. 作業中インタラクション

**作業中はチャット禁止。以下のみ許可:**

### 5.1 スタンプ

- 初期4種: `[wave] [thumbsup] [exclamation] [sleepy]`
- レート制限: 未決（→ open-questions.md）

### 5.2 作業カテゴリ + 短文

| フィールド | 必須 | 説明 |
|------------|------|------|
| カテゴリ | 必須 | プリセットから選択（例: 開発/デザイン/勉強/作業） |
| 短文 | 任意 | 自由入力。空でも可。 |

**更新ルール**: いつでも変更可。変更は即時反映。

---

## 6. 休憩中チャット

- **休憩中のみ**: テキストチャット可能
- **ミュート対象**: チャット含め全停止（閲覧のみ）
- **文字数制限**: 未決（→ open-questions.md）

---

## 7. 応援

### 7.1 MVP実装

**スタブ実装**（決済なし、UIのみ）

- プリセット金額: 300 / 500 / 1000 / 3000 円
- 実際の決済処理なし

### 7.2 交換性禁止（絶対条件）

**応援で以下を与えない:**

| 禁止項目 | 理由 |
|----------|------|
| 機能解放 | 金額による差別を作らない |
| 優先権 | 金額による差別を作らない |
| 通話権 | 金額による差別を作らない |
| ランキング | 煽り・競争を防ぐ |
| 累計表示 | 煽り・競争を防ぐ |

**代わりに提供:**

- 演出（アニメーション、エフェクト、サウンド）
- 応援メッセージの表示

### 7.3 応援者一覧

- **表示順**: 時系列のみ（新しい順）
- **禁止**: ランキング、累計金額表示
- **表示内容**: 表示名 + 金額 + 時刻

---

## 8. モデレーション

詳細は `moderation.md` を参照。

| アクション | 効果 |
|------------|------|
| **Kick** | セッションから退出。再入室ルールは配信者選択。 |
| **Mute** | 全アクション禁止（閲覧のみ）。期間指定可。 |
| **Ban (Room)** | ルーム単位で永久禁止。全セッションに適用。 |
| **Report** | 運営への通報。MVPはDB記録 + 配信者履歴閲覧。 |

---

## 9. ログ保持

| 項目 | Free | Pro |
|------|------|-----|
| 参加履歴 | なし | 30日 |
| 治安監査ログ | なし | 30日 |
| 応援ログ | なし | 30日（将来） |
| 発言ログ | なし | ピン保存のみ（PinnedMessage） |

**発言はピン保存のみ**: 配信者が明示的に保存したメッセージのみ永続化。

---

## 10. 参照先

| ドメイン | 参照ファイル |
|----------|--------------|
| ドメインモデル | `docs/ssot/domain-model.md` |
| フロー | `docs/ssot/flows.md` |
| 可視性詳細 | `docs/ssot/identity-visibility.md` |
| モデレーション詳細 | `docs/ssot/moderation.md` |
| Pro保持 | `docs/ssot/pro-retention.md` |
| 未決事項 | `docs/ssot/open-questions.md` |
