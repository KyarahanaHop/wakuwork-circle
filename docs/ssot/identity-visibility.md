# アイデンティティと可視性

> **Version**: v0.1  
> **Updated**: 2026-02-02  
> **Authority**: 可視性ルールの権威ファイル。

---

## 1. 概要

WakuWork Circle では「視聴者同士の匿名性」を基本とし、配信者のみが実IDを把握できる設計。

**目的**:
- Discordへの流出防止（視聴者がお互いを特定してDMで絡むのを防ぐ）
- 治安維持（荒らしの追跡は配信者が可能）
- プライバシー保護

---

## 2. 配信者に見える情報

| 情報 | 常時 | 条件付き |
|------|------|----------|
| Discord OAuth名 | OK | - |
| Discord ID | OK | - |
| ニックネーム | - | ユーザー設定時 |
| ルーム初回フラグ | OK | - |
| 過去の参加履歴 | - | Pro契約時（30日） |
| 過去のモデレーション履歴 | - | Pro契約時（30日） |

---

## 3. 視聴者同士の可視性

### 3.1 基本原則

**視聴者同士はお互いの実ID（Discord名）を見えない。**

表示されるのは「表示名」のみ。表示名は配信者が選択したモードで決まる。

### 3.2 表示名モード

| Mode | 名称 | 表示例 | 説明 |
|------|------|--------|------|
| 1 | 番号 | `参加者#1`, `参加者#7` | 完全匿名。入室順の番号。 |
| 2 | ニック | `たろう`, `UserX` | ユーザー設定のニックネーム。未設定時は番号。 |
| 3 | 動物名 | `やさしいペンギン`, `はしるイルカ` | 独自辞書から自動生成。 |

### 3.3 Mode 3: 動物名生成

**辞書構成**:
- 形容詞リスト: 約50語（やさしい、はしる、ねむい、etc.）
- 動物リスト: 約100語（ペンギン、イルカ、キツネ、etc.）

**生成ルール**:
```
displayName = 形容詞[hash % 形容詞数] + 動物[hash % 動物数]
hash = SHA256(userId + sessionId).substring(0, 8) を数値化
```

**特性**:
- 同一セッション内: 同じ名前（リロードしても固定）
- 別セッション: 異なる名前（sessionIdが変わるため）
- 衝突可能性: 約5000通り。100人規模なら衝突は稀。

**実装上の注意**:
- Google Meet等の実装を参照しない（独自辞書を作成）
- 日本語で自然な組み合わせになるよう辞書を設計

---

## 4. モード変更の影響

| 操作 | 影響 |
|------|------|
| セッション中のモード変更 | 即時反映。全員の表示名が変わる。 |
| ルーム設定でのデフォルト変更 | 次回セッションから適用。 |

---

## 5. 特殊ケース

### 5.1 配信者自身の表示

配信者は常に「配信者」または設定した名前で表示。モードの影響を受けない。

### 5.2 BANされたユーザー

- 配信者には「BAN済み」ラベル付きで表示
- 視聴者には表示されない（参加できないため）

### 5.3 ミュート中のユーザー

- 配信者には「ミュート中」ラベル付きで表示
- 視聴者には通常通り表示（ミュート状態は非公開）
