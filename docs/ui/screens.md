# 画面仕様

> **Version**: v0.1  
> **Updated**: 2026-02-02  
> **Authority**: 画面要件の権威ファイル。フロー詳細は `docs/ssot/flows.md` を参照。

---

## 1. 参加画面（Join / Home）

**パス**: `/`（メイン導線）または `/join`  
**用途**: セッションへの参加導線（トップページ）

### 1.1 レイアウト

```
┌─────────────────────────────────────┐
│ WakuWork Circle              [Theme]│ ← Header
├─────────────────────────────────────┤
│                                     │
│  セッションに参加                    │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ セッションコード            │   │ ← 英数字入力
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ 合言葉                      │   │ ← 単語入力（条件付き表示）
│  └─────────────────────────────┘   │    ※session.passphraseRequired=true時のみ
│                                     │
│          [ 参加する ]               │ ← Submit
│                                     │
│  ※ Discord ログインが必要です       │
└─────────────────────────────────────┘
```

### 1.2 機能

- **セッションコード入力**: 英数字6-8桁
- **合言葉入力**: 配信者が設定した単語（`passphraseRequired=true`時のみ表示）
- **認証チェック**: 未ログイン時はDiscord OAuthへ誘導
- **BANチェック**: BANされている場合はエラー表示
- **合言葉必須判定**: セッションコード検証後、`passphraseRequired`に応じて合言葉入力欄を表示/非表示

### 1.3 エラーケース

| エラー | メッセージ |
|--------|-----------|
| コード不正 | 「セッションが見つかりません」 |
| 合言葉不一致 | 「合言葉が違います」 |
| BAN済み | 「このルームには参加できません」 |
| 未ログイン | 「ログインしてください」 |

---

## 2. ロビー画面（Lobby）

**パス**: `/lobby/[sessionCode]`  
**用途**: 承認待ちの待機場所

### 2.1 レイアウト

```
┌─────────────────────────────────────┐
│ ← 戻る  ロビー               [Theme]│ ← Header
├─────────────────────────────────────┤
│                                     │
│         [配信者アイコン]            │
│         配信者名のルーム            │
│                                     │
│  ┌─────────────────────────────┐   │
│  │                             │   │
│  │    承認を待っています...     │   │
│  │                             │   │
│  │    [スピナー]                │   │
│  │                             │   │
│  └─────────────────────────────┘   │
│                                     │
│          [ キャンセル ]             │ ← 退出
│                                     │
└─────────────────────────────────────┘
```

### 2.2 機能

- **待機表示**: 承認待ちスピナー
- **ルーム情報**: 配信者名、ルーム名
- **キャンセル**: 参加をキャンセルして戻る
- **自動遷移**: 承認されたら自動でRoom画面へ

### 2.3 状態遷移

| イベント | 遷移先 |
|----------|--------|
| 承認 | Room画面 |
| 拒否 | Join画面（メッセージ付き） |
| タイムアウト | Join画面（メッセージ付き） |
| キャンセル | Join画面 |

---

## 3. Room画面（視聴者）

**パス**: `/room/[sessionCode]`  
**用途**: 視聴者が作業セッションに参加・応援する画面  
**前提**: セッション参加承認済み

### 3.1 レイアウト（作業中）

```
┌─────────────────────────────────────┐
│ ← 退出  [配信者名]           [Theme]│ ← Header
├─────────────────────────────────────┤
│ [作業中]  参加者: 12人      45:23   │ ← Status Bar
├─────────────────────────────────────┤
│                                     │
│  配信者の宣言                       │
│  「デザインシステムの設計を...」    │ ← Declaration
│                                     │
├─────────────────────────────────────┤
│  あなたの作業                       │
│  ┌─────────────────────────────┐   │
│  │ カテゴリ: [練習 ▼]          │   │ ← カテゴリ選択
│  │ 短文: [APIの実装中...]      │   │ ← 短文入力（任意）
│  └─────────────────────────────┘   │
├─────────────────────────────────────┤
│  スタンプ                           │
│  [挨拶] [いいね] [注目] [眠い]      │ ← スタンプ4種
├─────────────────────────────────────┤
│           [ 完了！ ]                │ ← Complete Button
├─────────────────────────────────────┤
│  応援する（交換性なし・演出のみ）   │
│  [¥300] [¥500] [¥1000] [¥3000]     │ ← Support Buttons
│  ※応援は配信者への支援金です...     │
└─────────────────────────────────────┘
```

### 3.2 レイアウト（休憩中）

```
┌─────────────────────────────────────┐
│ ← 退出  [配信者名]           [Theme]│ ← Header
├─────────────────────────────────────┤
│ [休憩中]  参加者: 12人      45:23   │ ← Status Bar
├─────────────────────────────────────┤
│  チャット                           │
│  ├─ ユーザーA: お疲れ様です！       │
│  ├─ ユーザーB: もう少しで完成！     │
│  └─ [入力欄]                        │ ← Chat Area
├─────────────────────────────────────┤
│  （スタンプ・作業内容は引き続き可） │
└─────────────────────────────────────┘
```

### 3.3 機能

| 機能 | 作業中 | 休憩中 |
|------|--------|--------|
| 状態表示 | OK | OK |
| タイマー | OK | OK |
| 宣言表示 | OK | OK |
| カテゴリ更新 | OK | OK |
| 短文更新 | OK | OK |
| スタンプ | OK | OK |
| 完了報告 | OK | OK |
| 応援 | OK | OK |
| チャット | NG | OK |

### 3.4 制約

- 応援ボタンには「交換性なし・演出のみ」の注記を表示
- 作業中はチャットエリアを非表示 or 非アクティブ化
- ミュート中は全アクション無効（閲覧のみ）

---

## 4. Creator Dashboard（配信者）

**パス**: `/dashboard`  
**用途**: 配信者がセッションを管理・分析する画面

### 4.1 レイアウト

```
┌─────────────────────────────────────┐
│ ← 戻る  Dashboard（配信者）  [Theme]│ ← Header
├─────────────────────────────────────┤
│ セッション管理                      │
│ [セッション開始] [セッション終了]   │ ← Session Controls
│ 合言葉: ●●●●● [更新]              │ ← Passphrase
├─────────────────────────────────────┤
│ 状態切り替え: [作業中] [休憩中]     │ ← Status Control
├─────────────────────────────────────┤
│ 参加者: 12人  完了率: 67%  45:23   │ ← Stats Row
├─────────────────────────────────────┤
│ 承認ロビー (2人待ち)                │
│ ├─ ユーザーX [初回] [承認][拒否]   │
│ └─ ユーザーY       [承認][拒否]   │
│ [一括承認]                          │ ← Lobby Queue
├─────────────────────────────────────┤
│ 参加者一覧                          │
│ ├─ ユーザーA [作業中] [...]        │
│ ├─ ユーザーB [休憩中] [...]        │
│ └─ ユーザーC [ミュート中] [...]    │ ← Members List
│     └→ [...] = Kick/Mute/Ban/Report │
├─────────────────────────────────────┤
│ 応援者一覧（時系列・最新10件）      │
│                                     │
│ ├─ ユーザーA  ¥1,000  14:30        │ ← 全閲覧者に金額表示
│ ├─ ユーザーB  ¥500    14:25        │    （時系列固定、並べ替え禁止）
│ └─ ユーザーC  ¥300    14:20        │
│                                     │
│ ※禁止: ランキング、合計表示、上位絞込 │ ← 煽り防止ルール
├─────────────────────────────────────┤
│ 通報キュー                          │
│ 現在通報はありません                │ ← Reports Queue
└─────────────────────────────────────┘
```

### 4.2 機能

| 機能 | 説明 |
|------|------|
| セッション開始 | 新しいセッションを開始。コード自動生成。 |
| セッション終了 | 現在のセッションを終了。 |
| 合言葉更新 | 合言葉を手動で変更。 |
| 状態切り替え | 作業中/休憩中の切り替え。 |
| 承認ロビー | 承認待ちユーザーの承認/拒否。初回フラグ表示。 |
| 参加者管理 | 各参加者のKick/Mute/Ban/Report。 |
| 応援者一覧 | 時系列順（最新10件）。ランキング・累計・上位絞込**禁止**。金額は**全閲覧者に表示**。並べ替え禁止。 |
| 通報キュー | 通報があった場合の対応リスト（MVP: 自分の通報履歴）。 |

### 4.3 モデレーションメニュー

参加者の「...」をクリックで表示:

```
┌────────────────┐
│ Kick           │ → 再入室可/不可を選択
│ Mute           │ → 10分/30分/60分/セッション終了まで
│ Ban (ルーム)   │ → 確認ダイアログ
│ Report         │ → カテゴリ選択 + 詳細入力
└────────────────┘
```

---

## 5. OBS Overlay

**パス**: `/overlay`  
**用途**: OBS等の配信ソフトで使用するオーバーレイ表示

### 5.1 レイアウト

```
┌──────────────────────────────┐
│ 参加者: 12    完了: 67%      │ ← Stats Bar (背景透過)
├──────────────────────────────┤
│ 最新の応援                    │
│ ユーザーAさんが¥1,000で応援！│ ← Latest Support
└──────────────────────────────┘
```

### 5.2 表示項目候補

| 項目 | 説明 | Pro設定 |
|------|------|---------|
| 状態 | 作業中 / 休憩中 | 表示/非表示 |
| タイマー | 経過時間 | 表示/非表示 |
| 参加者数 | 現在の人数 | 表示/非表示 |
| 完了率 | 完了者 / 全員 | 表示/非表示 |
| 応援最新 | 直近の応援表示 | 表示/非表示 |
| 宣言 | 配信者の宣言 | 表示/非表示 |

### 5.3 制約

- 背景は完全透過（OBS合成用）
- テキストは視認性確保（テーマに応じた色）
- アニメーションは控えめに
- Pro契約で表示項目カスタマイズ可能

---

## 6. ルーティングまとめ

| パス | 画面 | 説明 |
|------|------|------|
| `/` | Join（参加画面） | セッションコード入力。メイン導線。 |
| `/join/[code]` | Passphrase | 合言葉入力（passphraseRequired=true時） |
| `/lobby/[code]` | Lobby | 承認待ち画面 |
| `/room/[code]` | Room | 視聴者の作業画面 |
| `/dashboard/[code]` | Dashboard | 配信者管理画面 |
| `/overlay/[code]` | Overlay | OBS用透過表示 |

> **Note**: `/` をJoin画面にすることで、参加者の導線をシンプルにする。
> 配信者は `/dashboard/[code]` から直接アクセス。
