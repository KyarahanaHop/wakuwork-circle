---
reviewed: true
reviewed_at: 2026-02-02T16:00:00+09:00
task: "Phase 3: Roomで最低限の同席感を成立させる"
momus_verdict: OKAY
---

# 計画書: Phase 3 - Roomで最低限の同席感を成立させる

## 1. 目的
SSoT準拠のUI要素をRoom画面に追加し、同席作業の体験を成立させる。
作業カテゴリ、スタンプ、応援一覧を実装し、治安UI（レート制限・表示ルール）を適用する。

## 2. 完了条件 (Definition of Done)
- [ ] Room画面に作業カテゴリ（練習/勉強/制作/作業/休憩/その他）選択UIがある
- [ ] Room画面に短文（任意）入力フィールドがある
- [ ] Room画面にスタンプ4種（挨拶/いいね/！/眠い）ボタンがある
- [ ] スタンプにレート制限（同一ユーザー2秒間隔）が実装されている
- [ ] 休憩中のみチャットエリアが表示される（作業中は非アクティブ）
- [ ] 応援一覧が時系列順（最新10件）で表示され、金額が全閲覧者に見える
- [ ] 応援一覧にランキング・合計・上位絞込が存在しない（煽り防止）
- [ ] 完了ボタンの状態が他参加者にも反映される（UI表示）

## 3. 実行ステップ

### Step 1: 作業カテゴリ選択UIを追加
- **対象**: apps/web/src/app/room/[code]/page.tsx
- **アクション**:
  - SSoT準拠のカテゴリプリセットを定数化（6種類）
  - セレクトボックスまたはボタングループでカテゴリ選択UIを実装
  - 選択状態はuseStateで管理
  - 初期値: practice
- **成果物**: カテゴリ選択UI追加済みのRoom画面
- **検証**: http://localhost:3000/room/ABC123 を開き、カテゴリ選択UIが6項目を表示し、選択変更が可能であれば成功
- **失敗時**: コンポーネントをコメントアウトして元に戻す

### Step 2: 短文入力フィールドを追加
- **対象**: apps/web/src/app/room/[code]/page.tsx
- **アクション**:
  - テキスト入力フィールドを追加（placeholder: 今やっていることを短文で...）
  - 入力値はuseStateで管理
  - 文字数制限: 50文字
  - カテゴリ選択の下に配置
- **成果物**: 短文入力フィールド追加済み
- **検証**: 文字入力ができ、50文字で制限される（または警告が出る）こと
- **失敗時**: 入力フィールドを削除

### Step 3: スタンプ4種のUIを追加
- **対象**: apps/web/src/app/room/[code]/page.tsx
- **アクション**:
  - SSoT準拠のスタンプ定義（挨拶/いいね/！/眠い）
  - 4つのスタンプボタンを横並びに配置
  - ボタンには絵文字とラベルを表示
  - クリック時のハンドラーは現時点ではconsole.logのみ
- **成果物**: スタンプボタン4種追加済み
- **検証**: 4つのボタンが表示され、クリックでコンソールにログが出れば成功
- **失敗時**: ボタングループを削除

### Step 4: スタンプレート制限を実装
- **対象**: apps/web/src/app/room/[code]/page.tsx
- **アクション**:
  - レート制限フックを作成（2秒間隔）
  - スタンプ送信に適用
  - 制限中はボタンをdisabledまたは視覚的にグレーアウト
- **成果物**: レート制限機能実装済み
- **検証**: スタンプボタンを連続クリックしても、2秒以内の2回目は無視されること
- **失敗時**: レート制限ロジックをコメントアウト

### Step 5: 休憩中のみチャット表示の強化
- **対象**: apps/web/src/app/room/[code]/page.tsx
- **アクション**:
  - 既存のチャット表示ロジックを確認
  - 作業中の表示を強化: チャットエリアを完全に非表示ではなく、休憩中のみチャット利用可能メッセージを明確に表示
  - 視覚的に非アクティブであることを示す（opacityや背景色）
  - 休憩中は既存のチャット入力欄を有効化
- **成果物**: 休憩中のみチャット利用可能UI
- **検証**: working時はチャット入力不可、break時はチャット入力可能
- **失敗時**: 既存ロジックに戻す

### Step 6: 応援一覧（時系列・最新10件・金額表示）を実装
- **対象**: apps/web/src/app/room/[code]/page.tsx
- **アクション**:
  - モックの応援データを拡張（10件以上）
  - 時系列順（新しい順）にソート済みのデータを表示
  - 最新10件のみ表示
  - 各項目: 表示名 + 金額（円表記） + 時刻
  - 並べ替えUIを配置しない（時系列固定）
- **成果物**: 応援一覧UI追加済み
- **検証**: 10件の応援が時系列順（新→旧）で表示され、金額が見えること
- **失敗時**: 一覧表示を削除

### Step 7: 煽り防止ルールのUI適用
- **対象**: apps/web/src/app/room/[code]/page.tsx
- **アクション**:
  - 禁止UIの確認（存在しないことを確認）:
    - 応援合計表示がない
    - ランキング（1位/2位/3位）表示がない
    - トップ3等の絞り込みボタンがない
    - X回応援等の応援回数表示がない
  - 注意書きテキストを追加
- **成果物**: 煽り防止ルール適用済み
- **検証**: ソースコードをgrepし、合計・ランキング・トップ等の文字列が応援一覧関連コードに含まれていないこと
- **失敗時**: 余分なUI要素を削除

### Step 8: 完了ボタンの状態を他参加者に表示（モック）
- **対象**: apps/web/src/app/room/[code]/page.tsx
- **アクション**:
  - 完了ボタンの状態を他の参加者にも見えるようにする（モック）
  - 完了: X人 / Y人の表示を既存維持
  - 完了者リスト（モック）を追加表示
  - 通知UI（トースト風）を追加（オプション）
- **成果物**: 完了状態表示強化
- **検証**: 完了ボタンを押すと、完了率が変化し、完了者リストが更新される（モック動作）
- **失敗時**: 既存の完了ボタンに戻す

### Step 9: Dashboardの応援者一覧を更新
- **対象**: apps/web/src/app/dashboard/[code]/page.tsx
- **アクション**:
  - 応援者一覧を最新10件・時系列順に変更
  - 金額を明示的に表示（配信者も視聴者と同じ情報）
  - ランキング・合計表示がないことを確認
  - 注記を追加
- **成果物**: SSoT準拠の応援者一覧
- **検証**: Dashboardで応援者一覧が最新10件・時系列・金額表示であれば成功
- **失敗時**: 既存の表示に戻す

### Step 10: 全体的なUI調整とビルド検証
- **対象**: Room画面全体
- **アクション**:
  - 各セクションの間隔（margin/padding）を調整
  - モバイル表示の確認（レスポンシブ）
  - pnpm build でエラーがないことを確認
- **成果物**: 完成したRoom画面
- **検証**: pnpm build が exit code 0 で、ブラウザで見た目が崩れていない
- **失敗時**: ビルドエラーを1つずつ修正

## 4. リスクと対策
| リスク | 影響 | 対策 |
|--------|------|------|
| UIが詰まりすぎて見づらい | UX低下 | スクロール可能な高さを確保、セクション分割 |
| レート制限の厳しさ | ユーザーフラストレーション | MVPでは2秒、フィードバックで調整可能に |
| モックデータの不自然さ | 体験の質低下 | 現時点では許容、Phase 4で本データ |
| スマホ表示での崩れ | モバイルUX悪化 | Step 10でレスポンシブ確認必須 |

## 5. 制約
- SSoT準拠: docs/ssot/core.md Section 5（作業中インタラクション）
- SSoT準拠: docs/ssot/core.md Section 7.4（応援者一覧ルール）
- 交換性禁止: 応援で機能解放・ランキング表示をしない
- 治安UI強制: スタンプレート制限（2秒）、休憩中のみチャット
- スタンプ固定: MVPでは4種固定（追加はPro検討）
- カテゴリ固定: 6種のプリセットのみ（追加はPro検討）

## 6. レビュー結果

### 判定: OKAY

### Blocker
なし

### 任意提案
1. レート制限のUX: 制限中に視覚的フィードバック（クールダウンアニメーション等）を追加
2. スタンプアニメーション: MVPではconsole.logだが、簡易的なアニメーションを追加すると同席感が出る

### 良い点
- SSoTの禁止事項（ランキング/合計等）が明確に反映されている
- レート制限の実装が具体的
- 検証方法が明確（grepによる確認まで含む）
- Step 9でDashboard側も合わせて修正している

---

推定工数: 2-3時間
依存: Phase 1とPhase 2完了後（画面導線と状態管理が必要）
